Optimized L2 Geo Data Blocks

Мне было бы интересно узнать какой профит принесет данный код в реально работающих проектах, поэтому
прошу связаться со мной по контактам в профиле, если будете использовать его.

Часть кода разрабатывалась давным-давно под эгидой проекта `l2eve`, упоминание которого оставлено в пакедж-пути в дань памяти.

В коде много бойлерплейта вызова методов, бинарных операций и работы с индексами - читать и разбираться будет сложно, пишите по контактам, если будут вопросы))


# Основное

Оптимизация алгоритмов и способов хранения в памяти информации о высотах из геодаты.
Реализации алгоритмов сверены в тестах с поведением старой реализации L2J Server соответствующих блоков.

Результаты замеров бенчмарков на JMH и оценка занимаемой памяти с помощью JOL можно найти в `doc`.
Сами данные можно получить в соответствующих тестах. 
Так же есть несколько jfr профилей в `jfrs`, полученные во время разных JMH тестов (там оставлен закоменченный код для настройки съема jfr)

В двух словах на всем объеме геодаты для Interlude получилось снизить потребление памяти с 805Мб и 14.2кк объектов
до 447Мб и 7 объектов (`GeoDriverBytes`). Скорость в среднем поднялась от полутора до 4 раз. 
Отдельно надо отметить оптимизацию `MultilayerIndexed32Block`, где используется индексация и доработанный алгоритм на основе
отсортированных высот - там ускорение до 5 раз.

Тестирование на локальном сервере показало, что за условную единицу времени было обработано на 20% больше вызовов getNearestZ c 23.8кк до 28.8кк.
Водился парик варлордом из всех мобов, расположенных на равнинной части диноострова в течение 5-10 минут. 


# Загрузка

Реализована загрузка только .l2j файлов геодаты и своего бинарного формата.
Для баланса между скорость/потребление памяти есть настраиваемый `GeoConfig`, передаваемый в геодрайвера.

Для задач тестирования несколько блоков помещены в ресурсы, но для работы нужно будет положить .l2j файлы 
геодаты в `geodata`.


# Новые типы блоков

Были введены новые типы блоков, чтобы не перегружать логикой старые и иметь возможность гибко настраивать
баланс между скорость/занимаемым местом. Так же это позволяет легко сравнивать разные реализации.
Новых блоков 8 - 5 для замены Complex и 3 для Multilayer блоков.  

После анализа статистики распределения высот и nswe по блокам в геодате формировались подходы, 
позволяющие за счет малого разнообразия в каком-то параметре оптимизировать
способ хранения в памяти и упрощать доступ/поиск к информации.
В описании классов блоков указаны подробности предпосылок для выбора конкретного способа реализации.

Часть статистики собиралась ситуативно по необходимости, а часть теперь собирается в `BlockManager` 
при загрузке .l2j файлов и используется для выбора реализации - по аналогии можно собрать свою статистику.


# GeoDriverBytes

При загрузке геодаты .l2j файлы требуют предобработки и разбивки по объектам-блокам, на что тратится время, хоть и не большое. 
Но важно что есть накладные расходы на доступ к данным внутри блока, которых можно было избежать, если работать
с данными в общем массиве байт, а логику упрятать в статические методы и обойтись без более дорогих invokedynamic вызовов. 
Переход на общий массив байт так же позволил срезать и часть затрат памяти на обслуживание объектов (14кк объектов до оптимизаций).

Геодата в виде .l2j файлов разбирается аналогично стандартной работе, но после загрузки блока формируется его байтовое представление
и записывается в общий `ByteBuffer`. 
Для навигации ведется карта индексов начал блоков в этом буфере `blockDataOffsets`.
Для определения типа блока ведется массив `blockTypes` - именно на его основе выбирается нужный статический метод обработки.
Т.к. размеры блоков и их количество в регионе константны, то поиск нужного индекса блока внутри региона становится тривиальной задачей.
Однако количество регионов не фиксировано и поэтому требуется дополнительный шаг поиска начала данных региона - за это отвечает `regionFirstBlockIndexes`.

После загрузки и наполнения индексных массивов и общего буфера данных можно их сохранить, чтобы не делать этй загрузку в следующий раз.
При сохранении записываются 4 файла:
- data.bin - общим массив (буфер) данных блоков
- regionFirstBlockIndexes.bin - индексы начала региональных данных
- blockTypes.bin - данные массива с типами блоков
- blockDataOffsets.bin - смещения блоков данных в общем массив

Пример запуска генерации bin файлов и их использования можно найти в `GeoDriverBytesTest`.

Суммарный объем бин файлов выигрывает у .l2j файлов, если были выбраны опции, дающие выигрыш по памяти.
Например, для `GeoConfig.lowMemory()` записывается 448Мб данных против исходных 539Мб .l2j файлов.

NOTE: Если требуется поменять опции в `GeoConfig`, то при работе с bin файлами нужно их заново перегенерировать,
т.к. при загрузке бин файлов не производится переконвертация типов блоков и применяются уже сохраненные в blockTypes.


# GeoDriverBytesMmap

Естественным продолжением развития идеи загрузки уже готовых bin файлов является работа с ними в mmap режиме и разгрузки хипа.
Драйвер `GeoDriverBytesMmap` позволяет загрузку только готовых bin файлов, сформированных через `GeoDriverBytes`.
В остальном дублирует код `GeoDriverBytes`.

По тестам дает очень слабый, но фиксируемый выигрыш над `GeoDriverBytes`, скорее всего из-за режима read-only работы с файлами.

